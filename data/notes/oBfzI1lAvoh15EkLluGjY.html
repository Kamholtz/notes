<h1 id="on-off-switch"><a aria-hidden="true" class="anchor-heading icon-link" href="#on-off-switch"></a>On off Switch</h1>
<p><img src="/notes/assets/images/2022-02-28-22-04-52.png"></p>
<h2 id="implementing-attributes-clusters-and-endpoint"><a aria-hidden="true" class="anchor-heading icon-link" href="#implementing-attributes-clusters-and-endpoint"></a>Implementing Attributes, Clusters and Endpoint</h2>
<p>Requires implementation of <a href="/notes/notes/UQNqQHLUYqElh0F7CV9oq">On off Switch Configuration</a> which is lacking from nRF Connect at the moment. Required:</p>
<ul>
<li><code>zb_zcl_on_off_switch_config_addons.h</code></li>
</ul>
<p>Declare with cluster attrs with</p>
<ul>
<li><code>ZB_ZCL_DECLARE_ON_OFF_SWITCH_CONFIGURATION_ATTRIB_LIST</code></li>
</ul>
<p>Declare cluster list with:</p>
<ul>
<li><code>ZB_HA_DECLARE_ON_OFF_SWITCH_CLUSTER_LIST</code></li>
</ul>
<p>Declare end point with:</p>
<ul>
<li><code>ZB_HA_DECLARE_ON_OFF_SWITCH_EP</code></li>
</ul>
<p>Declare context with:</p>
<ul>
<li><code>ZBOSS_DECLARE_DEVICE_CTX_2_EP</code></li>
</ul>
<h2 id="device-signature"><a aria-hidden="true" class="anchor-heading icon-link" href="#device-signature"></a>Device Signature</h2>
<p><a href="/notes/notes/NKSTum1hoqIPue2kQRMKx">Device Signature</a></p>
<h2 id="20220306---zha-does-not-recognise-button-triggers"><a aria-hidden="true" class="anchor-heading icon-link" href="#20220306---zha-does-not-recognise-button-triggers"></a>2022.03.06 - ZHA does not recognise button triggers</h2>
<p><a href="/notes/notes/d5HL9VYkKY8H1Wi6BrAE4">Zigbee Home Automation</a> does not recognise that the device has triggers such as on/off for the On/Off client cluster despite the device signature containing the mandatory clusters.</p>
<ul class="contains-task-list">
<li class="task-list-item">
<p><input type="checkbox" checked disabled> Investigate <a href="/notes/notes/cdsp719v51zoi0ra7wj20xo">Discover Comands Generated</a> command</p>
<ul>
<li>The <a href="/notes/notes/zuhj9qga9exi2yocawvxhz2">Tradfri Remote</a> does not receive the <code>discover commands generated command</code> during pairing so this is likely not the way that it tells <a href="/notes/notes/d5HL9VYkKY8H1Wi6BrAE4">Zigbee Home Automation</a> the commands that it will send
<ul>
<li>There is still a chance that the <a href="/notes/notes/WqOZsAI3OSs35eCaPkUQ0">Coordinator</a> simply remembered the device and did not issue the command
<ul>
<li>Currently unsure how to guarantee a device is completely wiped from ZHA</li>
</ul>
</li>
</ul>
</li>
</ul>
<p></p><p></p><div class="portal-container">
<div class="portal-head">
<div class="portal-backlink">
<div class="portal-title">From <span class="portal-text-title">Discover Comands Generated</span></div>
<a href="/notes/notes/cdsp719v51zoi0ra7wj20xo" class="portal-arrow">Go to text <span class="right-arrow">â†’</span></a>
</div>
</div>
<div id="portal-parent-anchor" class="portal-parent" markdown="1">
<div class="portal-parent-fader-top"></div>
<div class="portal-parent-fader-bottom"></div><h2 id="command"><a aria-hidden="true" class="anchor-heading icon-link" href="#command"></a>Command</h2>
<p>This command may be used to discover all commands which may be generated (sent) by the cluster, including optional or manufacturer-specific commands</p>
<h2 id="reponse"><a aria-hidden="true" class="anchor-heading icon-link" href="#reponse"></a>Reponse</h2>
<p>The Discover Commands Generated Response command is sent in response to a Discover Commands
Generated command, and is used to discover which commands a particular cluster supports.</p>
</div></div><p></p><p></p>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled> <a href="/notes/notes/he1iazncbd7uor02fhw4u4v">Quirks</a></p>
<ul>
<li>Either create a quirk for zigpy implementing <code>device_automation_triggers</code> OR
<ul>
<li><a href="/notes/notes/he1iazncbd7uor02fhw4u4v#device_automation_triggers">device_automation_triggers</a></li>
</ul>
</li>
<li>Match the profile for a quirk with the cluster list, manufacturer ID, etc to make use of existing quirks...
<ul>
<li>This would be inflexible as it would represent a specific device and nothing else e.g. 5 button tradfri remote</li>
</ul>
</li>
</ul>
</li>
<li class="task-list-item">
<p><input type="checkbox" disabled> <a href="/notes/notes/ui2yy6amhf2dc7no85w7e3y">Triggers</a></p>
<ul>
<li>Specifying triggers at the Home Assistant level instead of the ZHA plugin level</li>
</ul>
</li>
<li class="task-list-item">
<p><input type="checkbox" checked disabled> Capture/respond to on/off commands within <a href="/notes/notes/OHeZb86UIV80gjx6YQp1K">Home Assistant</a></p>
<ul>
<li>
<p>Listen for events =></p>
<ul>
<li>Filter <code>zha_event</code> => switch on the device ID</li>
</ul>
<p><img src="/notes/assets/images/2022-03-06-16-54-30.png" alt="Filter zha_event"></p>
</li>
<li>
<p>Switch on the event ID</p>
<p><img src="/notes/assets/images/2022-03-06-16-56-11.png" alt="Switch on device ID"></p>
</li>
<li>
<p>Extract command from the payload and output to <code>debug</code></p>
<p><img src="/notes/assets/images/2022-03-06-16-57-01.png"></p>
</li>
</ul>
</li>
</ul>
<hr>
<strong>Children</strong>
<ol>
<li><a href="/notes/notes/NKSTum1hoqIPue2kQRMKx">Device Signature</a></li>
</ol>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/notes/notes/vn4QH8axQkezeOvv8cSG5">ZigBee Home Automation</a></li>
</ul>
<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><title>React Native</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="React Native"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://kamholtz.github.io/notes/notes/bzx7q88mrdzt3ylj90e8b6v/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="4/8/2022"/><meta property="article:modified_time" content="5/14/2022"/><link rel="canonical" href="https://kamholtz.github.io/notes/notes/bzx7q88mrdzt3ylj90e8b6v/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/notes/_next/static/css/3092aab0aa1f4483.css" as="style"/><link rel="stylesheet" href="/notes/_next/static/css/3092aab0aa1f4483.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/notes/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/notes/_next/static/chunks/webpack-9598d1b7297c7767.js" defer=""></script><script src="/notes/_next/static/chunks/framework-bb5c596eafb42b22.js" defer=""></script><script src="/notes/_next/static/chunks/main-0d50381774b20f5a.js" defer=""></script><script src="/notes/_next/static/chunks/pages/_app-639b01fffdc48b4b.js" defer=""></script><script src="/notes/_next/static/chunks/155-3a6c02d7e042edb7.js" defer=""></script><script src="/notes/_next/static/chunks/373-9c38fabb487d5920.js" defer=""></script><script src="/notes/_next/static/chunks/pages/notes/%5Bid%5D-b20175c77adb354a.js" defer=""></script><script src="/notes/_next/static/kBUqGaMzZHk_Y8dfP2rlV/_buildManifest.js" defer=""></script><script src="/notes/_next/static/kBUqGaMzZHk_Y8dfP2rlV/_ssgManifest.js" defer=""></script><script src="/notes/_next/static/kBUqGaMzZHk_Y8dfP2rlV/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout site-layout" style="margin-top:64px"><section class="ant-layout site-layout" style="flex-direction:row"><section class="ant-layout site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></section><section class="ant-layout side-layout-main" style="max-width:1200px;display:initial"><main class="ant-layout-content main-content" role="main" style="padding:0 24px"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="react-native"><a aria-hidden="true" class="anchor-heading icon-link" href="#react-native"></a>React Native</h1>
<h2 id="creating-reactive-components"><a aria-hidden="true" class="anchor-heading icon-link" href="#creating-reactive-components"></a>Creating Reactive Components</h2>
<p><a href="https://clojurians.slack.com/archives/C073DKH9P/p1649401136457189">Slack thread</a></p>
<p>Issue: child component was not updating in response an event which changed data that the child component was subscribed to. Adding the subscription to the parent caused it to update in response to the event, however.</p>
<ul>
<li><code>r/reactify-component</code></li>
<li><code>r/as-element</code></li>
</ul>
<blockquote>
<p>As to your issue, I'm 90% certain that it'll be fixed when you replace (paper/withTheme screen-main) with (paper/withTheme (r/reactify-component)) and remove the call to r/as-element from within screen-main.</p>
<p>The explanation is that by wrapping the body of screen-main in r/as-element, you prevent it from being a part of the reactive context. Any reaction (subscriptions are reactions) used outside of a reactive context cannot trigger re-render.</p>
</blockquote>
<h2 id="navigation-stack-and-state-persistence"><a aria-hidden="true" class="anchor-heading icon-link" href="#navigation-stack-and-state-persistence"></a>Navigation Stack and State Persistence</h2>
<h3 id="navigationcontainer-onstatechange-and-initialstate"><a aria-hidden="true" class="anchor-heading icon-link" href="#navigationcontainer-onstatechange-and-initialstate"></a>NavigationContainer onStateChange and initialState</h3>
<p><a href="https://reactnavigation.org/docs/state-persistence/">NavigationContainer state persistence</a> describes how to persist state in <a href="/notes/notes/v28awlfsz2x05oteb3mzr4p">JS</a>. The <a href="/notes/notes/d386bb46-7fe4-4b90-bf11-7b00157117a8">ClojureScript</a> version using an atom is described in the following slack thread:</p>
<p><a href="https://clojurians.slack.com/archives/C0E1SN0NM/p1652439790706039?thread_ts=1652431961.516389&#x26;cid=C0E1SN0NM">Clojurians Slack - NavigationContainer state persistence</a></p>
<blockquote>
<p>To persist nav state you could also pass <code>{:onStateChange on-state-change :initialState @state}</code> to <code>NavigationContainer</code>.
The code for persisting state could look like:</p>
</blockquote>
<pre class="language-clojure"><code class="language-clojure"> <span class="token punctuation">(</span><span class="token keyword">defonce</span> state <span class="token punctuation">(</span><span class="token function">atom</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

 <span class="token punctuation">(</span><span class="token keyword">defn-</span> persist-state! <span class="token punctuation">[</span>state-obj<span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token function">js/Promise.</span>
     <span class="token punctuation">(</span><span class="token keyword">fn</span> <span class="token punctuation">[</span>resolve _<span class="token punctuation">]</span>
       <span class="token punctuation">(</span><span class="token function">reset!</span> state state-obj<span class="token punctuation">)</span>
       <span class="token punctuation">(</span><span class="token keyword">resolve</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token punctuation">(</span><span class="token keyword">defn-</span> on-state-change <span class="token punctuation">[</span>state<span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token function">persist-state!</span> state<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<blockquote>
<p>And for storing the ref, you could use <code>useNavigationContainerRef</code> hook to get the ref. (edited)</p>
</blockquote>
<h3 id="navigationcontainers-resetroot-and-getrootstate"><a aria-hidden="true" class="anchor-heading icon-link" href="#navigationcontainers-resetroot-and-getrootstate"></a>NavigationContainer's resetRoot and getRootState</h3>
<ul>
<li>Store the state using <code>getRootState</code></li>
<li>Load it again when the app is reloaded with <code>resetRoot</code></li>
</ul>
<p><a href="https://gist.github.com/olivergeorge/981bc5135fa47253cba50fd125495d0b">app-fx.cljs</a></p>
<h3 id="other-approaches-i-tried-or-researched"><a aria-hidden="true" class="anchor-heading icon-link" href="#other-approaches-i-tried-or-researched"></a>Other approaches I tried or researched</h3>
<h4 id="appcontainer-with-persistnavigationstate-and-loadnavigationstate"><a aria-hidden="true" class="anchor-heading icon-link" href="#appcontainer-with-persistnavigationstate-and-loadnavigationstate"></a>AppContainer with persistNavigationState and loadNavigationState</h4>
<p><a href="https://github.com/eihli/cljs-react-native-starter/blob/master/src/example/core.cljs">cljs-react-native-starter/core.cljs at master · eihli/cljs-react-native-starter</a></p>
<h4 id="storing-in-re-frame-db-does-not-reload-it-though"><a aria-hidden="true" class="anchor-heading icon-link" href="#storing-in-re-frame-db-does-not-reload-it-though"></a>Storing in re-frame DB (does not reload it though?)</h4>
<p>From Clojurians slack:</p>
<blockquote>
<p>I have a question related to ReactNavigation. I want to be able to reference the root navigator globally. In a regular React I can obtain the reference while rendering a component. How to do the same in CLJS/Reagent?</p>
</blockquote>
<pre class="language-clojure"><code class="language-clojure"><span class="token comment">; Store navigator in app db</span>
<span class="token comment">; Get the navigator from the NavaigationContainer using :ref</span>
<span class="token punctuation">(</span><span class="token keyword">defn</span> app-root <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token symbol">:></span> appnav/central-app-switch <span class="token punctuation">{</span><span class="token symbol">:ref</span> <span class="token punctuation">(</span><span class="token keyword">fn</span> <span class="token punctuation">[</span>this<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token function">dispatch</span> <span class="token punctuation">[</span><span class="token symbol">:set-root-navigator</span> this<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment">; Effect for navigating</span>
<span class="token punctuation">(</span><span class="token function">reg-fx</span>
  <span class="token symbol">:navigate</span>
  <span class="token punctuation">(</span><span class="token keyword">fn</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>root-navigator route params<span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token function">.dispatch</span> root-navigator <span class="token punctuation">(</span><span class="token function">navactions/navigate-to</span> route params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">; Handler that triggers the effect above</span>
<span class="token punctuation">(</span><span class="token function">reg-event-fx</span>
  <span class="token symbol">:handle-login-success</span>
  validate-spec
  <span class="token punctuation">(</span><span class="token keyword">fn</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token symbol">:keys</span> <span class="token punctuation">[</span>db<span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>_ session-info<span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token punctuation">(</span><span class="token keyword">println</span> db<span class="token punctuation">)</span>
    <span class="token punctuation">{</span><span class="token symbol">:db</span> <span class="token punctuation">(</span><span class="token keyword">-></span> db
         <span class="token punctuation">(</span><span class="token function">assoc-in</span> <span class="token punctuation">[</span><span class="token symbol">:dcn-session</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token keyword">-></span> session-info
                                      <span class="token punctuation">(</span><span class="token function">update-in</span> <span class="token punctuation">[</span><span class="token symbol">:userInfo</span> <span class="token symbol">:gender</span><span class="token punctuation">]</span> keyword<span class="token punctuation">)</span>
                                      <span class="token punctuation">(</span><span class="token function">update-in</span> <span class="token punctuation">[</span><span class="token symbol">:userInfo</span> <span class="token symbol">:siteRoles</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token keyword">fn</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token keyword">map</span> <span class="token operator">#</span><span class="token punctuation">(</span><span class="token keyword">keyword</span> %<span class="token punctuation">)</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token symbol">:navigate</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token symbol">:root-navigator</span> db<span class="token punctuation">)</span> <span class="token symbol">:Main</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="libraries-for-storing-app-state"><a aria-hidden="true" class="anchor-heading icon-link" href="#libraries-for-storing-app-state"></a>Libraries for storing app state</h3>
<p>I ultimately decided not to use any libraries/wrappers for storing state as it seemed like a lot of overhead to include another dependency</p>
<ul>
<li>
<p><a href="https://github.com/seantempesta/cljs-react-navigation">GitHub - seantempesta/cljs-react-navigation: CLJS wrappers for react-navigation</a></p>
</li>
<li>
<p><a href="https://github.com/flexsurfer/rn-shadow-steroid">GitHub - flexsurfer/rn-shadow-steroid: React Native with shadow-cljs on steroids</a></p>
<ul>
<li>Blog post showing how to use <code>steroid</code> to perist navigation state <a href="https://hackmd.io/@byc70E6fQy67hPMN0WM9_A/rJilnJxE8">Confidence and Joy: React Native Development with ClojureScript and re-frame - HackMD</a></li>
</ul>
</li>
</ul>
<hr>
<strong>Children</strong>
<ol>
<li><a href="/notes/notes/afqyaa93vuy4pz1mzhjn26v">Issues</a></li>
</ol>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/notes/notes/yrtsvo9ylwmcoz8svps5kko">Install</a></li>
</ul></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#creating-reactive-components" title="Creating Reactive Components">Creating Reactive Components</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#navigation-stack-and-state-persistence" title="Navigation Stack and State Persistence">Navigation Stack and State Persistence</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#navigationcontainer-onstatechange-and-initialstate" title="NavigationContainer onStateChange and initialState">NavigationContainer onStateChange and initialState</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#navigationcontainers-resetroot-and-getrootstate" title="NavigationContainer&#x27;s resetRoot and getRootState">NavigationContainer&#x27;s resetRoot and getRootState</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#other-approaches-i-tried-or-researched" title="Other approaches I tried or researched">Other approaches I tried or researched</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#appcontainer-with-persistnavigationstate-and-loadnavigationstate" title="AppContainer with persistNavigationState and loadNavigationState">AppContainer with persistNavigationState and loadNavigationState</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#storing-in-re-frame-db-does-not-reload-it-though" title="Storing in re-frame DB (does not reload it though?)">Storing in re-frame DB (does not reload it though?)</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#libraries-for-storing-app-state" title="Libraries for storing app state">Libraries for storing app state</a></div></div></div></div></div></div></div></div></div></main><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></section></section></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"bzx7q88mrdzt3ylj90e8b6v","title":"React Native","desc":"","updated":1652492505519,"created":1649402877011,"custom":{},"fname":"lang.cljs.libs.react-native","type":"note","vault":{"fsPath":"vault"},"contentHash":"2df1c8d63757dfc99bd89a5857d6d1c8","links":[{"type":"wiki","from":{"fname":"lang.cljs.libs.react-native","id":"bzx7q88mrdzt3ylj90e8b6v","vaultName":"vault"},"value":"lang.js","alias":"lang.js","position":{"start":{"line":22,"column":128,"offset":1061},"end":{"line":22,"column":139,"offset":1072},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"lang.js"}},{"type":"wiki","from":{"fname":"lang.cljs.libs.react-native","id":"bzx7q88mrdzt3ylj90e8b6v","vaultName":"vault"},"value":"lang.cljs","alias":"lang.cljs","position":{"start":{"line":22,"column":145,"offset":1078},"end":{"line":22,"column":158,"offset":1091},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"lang.cljs"}},{"from":{"fname":"lang.cljs.expo.install","vaultName":"vault"},"type":"backlink","position":{"start":{"line":84,"column":1,"offset":2243},"end":{"line":84,"column":32,"offset":2274},"indent":[]},"value":"lang.cljs.libs.react-native","alias":"lang.cljs.libs.react-native"}],"anchors":{"creating-reactive-components":{"type":"header","text":"Creating Reactive Components","value":"creating-reactive-components","line":10,"column":0,"depth":2},"navigation-stack-and-state-persistence":{"type":"header","text":"Navigation Stack and State Persistence","value":"navigation-stack-and-state-persistence","line":24,"column":0,"depth":2},"navigationcontainer-onstatechange-and-initialstate":{"type":"header","text":"NavigationContainer onStateChange and initialState","value":"navigationcontainer-onstatechange-and-initialstate","line":26,"column":0,"depth":3},"navigationcontainers-resetroot-and-getrootstate":{"type":"header","text":"NavigationContainer's resetRoot and getRootState","value":"navigationcontainers-resetroot-and-getrootstate","line":50,"column":0,"depth":3},"other-approaches-i-tried-or-researched":{"type":"header","text":"Other approaches I tried or researched","value":"other-approaches-i-tried-or-researched","line":57,"column":0,"depth":3},"appcontainer-with-persistnavigationstate-and-loadnavigationstate":{"type":"header","text":"AppContainer with persistNavigationState and loadNavigationState","value":"appcontainer-with-persistnavigationstate-and-loadnavigationstate","line":59,"column":0,"depth":4},"storing-in-re-frame-db-does-not-reload-it-though":{"type":"header","text":"Storing in re-frame DB (does not reload it though?)","value":"storing-in-re-frame-db-does-not-reload-it-though","line":63,"column":0,"depth":4},"libraries-for-storing-app-state":{"type":"header","text":"Libraries for storing app state","value":"libraries-for-storing-app-state","line":96,"column":0,"depth":3}},"children":["afqyaa93vuy4pz1mzhjn26v"],"parent":"32g1bzlvtnzy9bvzgramm06","data":{}},"body":"\u003ch1 id=\"react-native\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#react-native\"\u003e\u003c/a\u003eReact Native\u003c/h1\u003e\n\u003ch2 id=\"creating-reactive-components\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#creating-reactive-components\"\u003e\u003c/a\u003eCreating Reactive Components\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://clojurians.slack.com/archives/C073DKH9P/p1649401136457189\"\u003eSlack thread\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIssue: child component was not updating in response an event which changed data that the child component was subscribed to. Adding the subscription to the parent caused it to update in response to the event, however.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003er/reactify-component\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003er/as-element\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAs to your issue, I'm 90% certain that it'll be fixed when you replace (paper/withTheme screen-main) with (paper/withTheme (r/reactify-component)) and remove the call to r/as-element from within screen-main.\u003c/p\u003e\n\u003cp\u003eThe explanation is that by wrapping the body of screen-main in r/as-element, you prevent it from being a part of the reactive context. Any reaction (subscriptions are reactions) used outside of a reactive context cannot trigger re-render.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"navigation-stack-and-state-persistence\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#navigation-stack-and-state-persistence\"\u003e\u003c/a\u003eNavigation Stack and State Persistence\u003c/h2\u003e\n\u003ch3 id=\"navigationcontainer-onstatechange-and-initialstate\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#navigationcontainer-onstatechange-and-initialstate\"\u003e\u003c/a\u003eNavigationContainer onStateChange and initialState\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://reactnavigation.org/docs/state-persistence/\"\u003eNavigationContainer state persistence\u003c/a\u003e describes how to persist state in \u003ca href=\"/notes/notes/v28awlfsz2x05oteb3mzr4p\"\u003eJS\u003c/a\u003e. The \u003ca href=\"/notes/notes/d386bb46-7fe4-4b90-bf11-7b00157117a8\"\u003eClojureScript\u003c/a\u003e version using an atom is described in the following slack thread:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://clojurians.slack.com/archives/C0E1SN0NM/p1652439790706039?thread_ts=1652431961.516389\u0026#x26;cid=C0E1SN0NM\"\u003eClojurians Slack - NavigationContainer state persistence\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eTo persist nav state you could also pass \u003ccode\u003e{:onStateChange on-state-change :initialState @state}\u003c/code\u003e to \u003ccode\u003eNavigationContainer\u003c/code\u003e.\nThe code for persisting state could look like:\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre class=\"language-clojure\"\u003e\u003ccode class=\"language-clojure\"\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003edefonce\u003c/span\u003e state \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eatom\u003c/span\u003e \u003cspan class=\"token boolean\"\u003enil\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003edefn-\u003c/span\u003e persist-state! \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003estate-obj\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003ejs/Promise.\u003c/span\u003e\n     \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eresolve _\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n       \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003ereset!\u003c/span\u003e state state-obj\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n       \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eresolve\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003edefn-\u003c/span\u003e on-state-change \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003estate\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003epersist-state!\u003c/span\u003e state\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAnd for storing the ref, you could use \u003ccode\u003euseNavigationContainerRef\u003c/code\u003e hook to get the ref. (edited)\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"navigationcontainers-resetroot-and-getrootstate\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#navigationcontainers-resetroot-and-getrootstate\"\u003e\u003c/a\u003eNavigationContainer's resetRoot and getRootState\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eStore the state using \u003ccode\u003egetRootState\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eLoad it again when the app is reloaded with \u003ccode\u003eresetRoot\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"https://gist.github.com/olivergeorge/981bc5135fa47253cba50fd125495d0b\"\u003eapp-fx.cljs\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"other-approaches-i-tried-or-researched\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#other-approaches-i-tried-or-researched\"\u003e\u003c/a\u003eOther approaches I tried or researched\u003c/h3\u003e\n\u003ch4 id=\"appcontainer-with-persistnavigationstate-and-loadnavigationstate\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#appcontainer-with-persistnavigationstate-and-loadnavigationstate\"\u003e\u003c/a\u003eAppContainer with persistNavigationState and loadNavigationState\u003c/h4\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/eihli/cljs-react-native-starter/blob/master/src/example/core.cljs\"\u003ecljs-react-native-starter/core.cljs at master · eihli/cljs-react-native-starter\u003c/a\u003e\u003c/p\u003e\n\u003ch4 id=\"storing-in-re-frame-db-does-not-reload-it-though\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#storing-in-re-frame-db-does-not-reload-it-though\"\u003e\u003c/a\u003eStoring in re-frame DB (does not reload it though?)\u003c/h4\u003e\n\u003cp\u003eFrom Clojurians slack:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eI have a question related to ReactNavigation. I want to be able to reference the root navigator globally. In a regular React I can obtain the reference while rendering a component. How to do the same in CLJS/Reagent?\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre class=\"language-clojure\"\u003e\u003ccode class=\"language-clojure\"\u003e\u003cspan class=\"token comment\"\u003e; Store navigator in app db\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e; Get the navigator from the NavaigationContainer using :ref\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003edefn\u003c/span\u003e app-root \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token symbol\"\u003e:\u003e\u003c/span\u003e appnav/central-app-switch \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token symbol\"\u003e:ref\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ethis\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003edispatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token symbol\"\u003e:set-root-navigator\u003c/span\u003e this\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"token comment\"\u003e; Effect for navigating\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003ereg-fx\u003c/span\u003e\n  \u003cspan class=\"token symbol\"\u003e:navigate\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eroot-navigator route params\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003e.dispatch\u003c/span\u003e root-navigator \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003enavactions/navigate-to\u003c/span\u003e route params\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e; Handler that triggers the effect above\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003ereg-event-fx\u003c/span\u003e\n  \u003cspan class=\"token symbol\"\u003e:handle-login-success\u003c/span\u003e\n  validate-spec\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token symbol\"\u003e:keys\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003edb\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e_ session-info\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eprintln\u003c/span\u003e db\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token symbol\"\u003e:db\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003e-\u003e\u003c/span\u003e db\n         \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eassoc-in\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token symbol\"\u003e:dcn-session\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003e-\u003e\u003c/span\u003e session-info\n                                      \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eupdate-in\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token symbol\"\u003e:userInfo\u003c/span\u003e \u003cspan class=\"token symbol\"\u003e:gender\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e keyword\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                      \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eupdate-in\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token symbol\"\u003e:userInfo\u003c/span\u003e \u003cspan class=\"token symbol\"\u003e:siteRoles\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003emap\u003c/span\u003e \u003cspan class=\"token operator\"\u003e#\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ekeyword\u003c/span\u003e %\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n     \u003cspan class=\"token symbol\"\u003e:navigate\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token symbol\"\u003e:root-navigator\u003c/span\u003e db\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token symbol\"\u003e:Main\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"libraries-for-storing-app-state\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#libraries-for-storing-app-state\"\u003e\u003c/a\u003eLibraries for storing app state\u003c/h3\u003e\n\u003cp\u003eI ultimately decided not to use any libraries/wrappers for storing state as it seemed like a lot of overhead to include another dependency\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/seantempesta/cljs-react-navigation\"\u003eGitHub - seantempesta/cljs-react-navigation: CLJS wrappers for react-navigation\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/flexsurfer/rn-shadow-steroid\"\u003eGitHub - flexsurfer/rn-shadow-steroid: React Native with shadow-cljs on steroids\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBlog post showing how to use \u003ccode\u003esteroid\u003c/code\u003e to perist navigation state \u003ca href=\"https://hackmd.io/@byc70E6fQy67hPMN0WM9_A/rJilnJxE8\"\u003eConfidence and Joy: React Native Development with ClojureScript and re-frame - HackMD\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cstrong\u003eChildren\u003c/strong\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"/notes/notes/afqyaa93vuy4pz1mzhjn26v\"\u003eIssues\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003cstrong\u003eBacklinks\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/notes/notes/yrtsvo9ylwmcoz8svps5kko\"\u003eInstall\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","noteIndex":{"id":"wn8PE1RhG0znK1alrGFYv","title":"Welcome","desc":"","updated":1647739693733,"created":1631901573363,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"25f6a870234e6662373e3b363ac6e7ff","links":[],"anchors":{},"children":["9nbHM9DXYJiw0wOL5EHqu","49nbdlbyhuggwhb17c4ckrc","etnjoq40t5e9gp3i9i0ebg4","SEWMNyq5ejB4Uu2o5gD1F","30970790-4080-4f49-a9e6-d3ea9f8a2f5e","oGtULAvsKCL7IqVaNh9x5","kxlbgahdm89suj3rh234zd2","haa2RJrh1FmtvgDrCgMuO","sHUgvR09969GI1KByYETE","6y2lfHzDgTsk4Jrl7vL24","D6TMhnzbxXgM6H69SHyDd","9itq04txzxzb62nmstlovti","4nqbPU2WajRDXAXqSDnwo","5acd228c-faa2-4c6c-8fed-6abd55a1e819","2pquOIrwpkRIflevQW2UU","fe3d08bb-d6f0-4d4b-9a4d-3eae285c8f70","phaz4bx38xr32daxmt0npt5","b0k4g697aehphlpejqdd6hm","jriu7nrk5w8o38yu17adio4","g7ydg6006fa1pyg4364yi0q"],"parent":null,"data":{},"body":"\nThese are my public notes!\n\n\u003e This website is generated by a Dendron template. For more information, see the [template README file](https://github.com/dendronhq/template.publish.github-action/).\n\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"dendronVersion":"0.86.1","enableEditorDecorations":true,"enableHandlebarTemplates":true,"enableFullHierarchyNoteTitle":false,"enableSmartRefs":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"assetsPrefix":"/notes","copyAssets":true,"siteHierarchies":["root"],"enableSiteLastModified":true,"siteRootDir":"docs","siteUrl":"https://kamholtz.github.io","enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"writeStubs":false,"seo":{"title":"whomst'd've","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enablePrettyLinks":true,"enableTaskNotes":true,"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"bzx7q88mrdzt3ylj90e8b6v"},"buildId":"kBUqGaMzZHk_Y8dfP2rlV","assetPrefix":"/notes","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>